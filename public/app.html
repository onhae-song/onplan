<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OnPlan — AI 프로덕 기획자</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Pretendard+Variable:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f5f5f7;--white:#fff;--black:#111;
  --accent:#a8cc00;--accent-bright:#d4f53c;
  --accent-bg:rgba(168,204,0,.08);--accent-border:rgba(168,204,0,.2);
  --border:#e0e0e0;--border-light:#ebebeb;
  --g800:#333;--g700:#555;--g600:#777;--g500:#999;--g400:#aaa;--g300:#ccc;--g100:#f0f0f0;
  --warn:#e8740a;--warn-bg:rgba(232,116,10,.06);--warn-border:rgba(232,116,10,.18);
  --conflict:#d63031;--conflict-bg:rgba(214,48,49,.05);--conflict-border:rgba(214,48,49,.14);
  --en:'Outfit',sans-serif;--kr:'Pretendard Variable','Pretendard',-apple-system,sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--kr);background:var(--bg);color:var(--black);min-height:100vh;-webkit-font-smoothing:antialiased;}

/* NAV */
.nav{height:52px;background:var(--white);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 32px;position:sticky;top:0;z-index:100;}
.nav-logo svg{height:22px;width:auto;}
.nav-status{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--g500);}

/* LAYOUT */
.page{display:none;min-height:calc(100vh - 52px);}
.page.active{display:block;}
.center{max-width:560px;margin:0 auto;padding:48px 24px;}
.center-sm{max-width:440px;margin:0 auto;padding:48px 24px;}
.center-wide{max-width:920px;margin:0 auto;padding:40px 24px;}

/* COMMON */
.tag{font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--accent);margin-bottom:16px;}
.title{font-family:var(--en);font-size:36px;font-weight:800;letter-spacing:-1.5px;line-height:1.1;margin-bottom:10px;}
.title em{font-style:normal;color:var(--accent);}
.desc{color:var(--g600);font-size:15px;line-height:1.7;margin-bottom:32px;}
.card{background:var(--white);border:1px solid var(--border);padding:32px;}
.card-title{font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--g500);padding-bottom:14px;margin-bottom:24px;border-bottom:1px solid var(--border);}

/* FORM */
.fg{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;}
.ff{margin-bottom:16px;}
.fl{display:block;font-size:10px;letter-spacing:1px;text-transform:uppercase;color:var(--g700);margin-bottom:7px;font-weight:600;}
.fl .req{color:var(--accent);}
.fi,.fs,.ft{width:100%;padding:12px 14px;border:1px solid var(--border);background:var(--bg);font-size:14px;font-family:inherit;outline:none;color:var(--black);}
.fi:focus,.fs:focus,.ft:focus{border-color:var(--accent);}
.fi::placeholder,.ft::placeholder{color:var(--g400);}
.fs{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:36px;}
.ft{resize:none;min-height:64px;line-height:1.6;}

/* BUTTONS */
.btn{width:100%;padding:16px;background:var(--black);color:var(--white);border:none;border-radius:8px;font-family:var(--en);font-weight:700;font-size:14px;cursor:pointer;margin-top:8px;}
.btn:hover{background:#222;}
.btn-accent{background:var(--accent);color:var(--black);}
.btn-accent:hover{background:var(--accent-bright);}
.btn-ghost{padding:7px 14px;background:transparent;border:1px solid var(--border);color:var(--g500);cursor:pointer;font-size:11px;font-family:inherit;display:inline-block;}
.btn-ghost:hover{border-color:var(--g700);color:var(--g800);}

/* ROLE CARDS */
.roles{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;}
.role-card{padding:16px;border:1.5px solid var(--border);cursor:pointer;text-align:center;transition:all .2s;background:var(--white);}
.role-card:hover{border-color:var(--g300);}
.role-card.selected{border-color:var(--accent);background:var(--accent-bg);}
.role-card-name{font-size:13px;font-weight:600;margin-bottom:2px;}
.role-card-desc{font-size:11px;color:var(--g500);}

/* CHAT */
.chat-wrap{max-width:680px;margin:0 auto;height:calc(100vh - 52px - 100px);display:flex;flex-direction:column;background:var(--white);border:1px solid var(--border);}
.chat-hd{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.chat-ai{display:flex;align-items:center;gap:10px;}
.chat-av{width:32px;height:32px;background:var(--black);display:flex;align-items:center;justify-content:center;font-family:var(--en);font-weight:800;font-size:10px;color:var(--accent-bright);}
.chat-name{font-weight:600;font-size:14px;}
.chat-role-label{font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--g500);}
.chat-dots{display:flex;gap:4px;}
.chat-dot{width:6px;height:6px;border-radius:50%;background:var(--border);transition:background .3s;}
.chat-dot.on{background:var(--accent);}
.chat-dot.now{background:var(--accent-bright);}
.chat-body{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:14px;}
.msg{display:flex;gap:8px;align-items:flex-start;}
.msg.user{flex-direction:row-reverse;}
.msg-av{width:28px;height:28px;flex-shrink:0;background:var(--black);display:flex;align-items:center;justify-content:center;font-family:var(--en);font-weight:800;font-size:8px;color:var(--accent-bright);margin-top:2px;}
.msg-b{max-width:78%;padding:12px 16px;font-size:14px;line-height:1.7;}
.msg.assistant .msg-b{background:var(--bg);border-left:2px solid var(--accent);}
.msg.user .msg-b{background:var(--black);color:#e0e0e0;}
.msg-typing{display:flex;gap:4px;padding:14px 18px;background:var(--bg);border-left:2px solid var(--accent);}
.msg-typing span{width:5px;height:5px;border-radius:50%;background:var(--g400);animation:tp 1.2s infinite;}
.msg-typing span:nth-child(2){animation-delay:.2s;}
.msg-typing span:nth-child(3){animation-delay:.4s;}
@keyframes tp{0%,60%,100%{opacity:.3;transform:translateY(0);}30%{opacity:1;transform:translateY(-3px);}}
.chat-in{padding:14px 16px;border-top:1px solid var(--border);display:flex;gap:8px;flex-shrink:0;}
.chat-fi{flex:1;padding:12px 14px;border:1px solid var(--border);background:var(--bg);font-size:14px;font-family:inherit;outline:none;resize:none;}
.chat-fi:focus{border-color:var(--accent);}
.chat-fi::placeholder{color:var(--g400);}
.chat-send{width:46px;height:46px;flex-shrink:0;background:var(--black);border:none;cursor:pointer;color:white;font-size:18px;display:flex;align-items:center;justify-content:center;}

/* OWNER DASHBOARD */
.dash-stat{display:flex;gap:12px;margin-bottom:24px;}
.dash-stat-card{flex:1;background:var(--white);border:1px solid var(--border);padding:20px;text-align:center;}
.dash-stat-num{font-family:var(--en);font-size:28px;font-weight:800;}
.dash-stat-label{font-size:11px;color:var(--g500);margin-top:4px;}
.participant-list{background:var(--white);border:1px solid var(--border);margin-bottom:24px;}
.participant-row{padding:14px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border-light);}
.participant-row:last-child{border-bottom:none;}
.participant-info{display:flex;align-items:center;gap:12px;}
.participant-avatar{width:32px;height:32px;border-radius:50%;background:var(--g100);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:600;color:var(--g700);}
.participant-name{font-size:14px;font-weight:600;}
.participant-role-tag{font-size:11px;color:var(--g500);}
.status-done{font-size:11px;color:var(--accent);font-weight:600;}
.status-wait{font-size:11px;color:var(--g400);}

/* PRD */
.prd-hd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:28px;}
.prd-tag{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--g500);margin-bottom:6px;}
.prd-title{font-family:var(--en);font-size:20px;font-weight:700;}
.prd-meta{font-size:12px;color:var(--g500);margin-top:4px;}
.prd-actions{display:flex;gap:8px;margin-top:6px;}

/* Section nav cards */
.sg{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:40px;}
.sc{background:var(--white);border:1px solid var(--border);padding:14px;cursor:pointer;position:relative;overflow:hidden;transition:all .2s;}
.sc:hover{border-color:var(--g300);box-shadow:0 2px 8px rgba(0,0,0,.04);}
.sc::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;background:var(--border);}
.sc.done::before{background:var(--accent);}
.sc.lock::before{background:var(--g300);}
.sc.lock{opacity:.55;}
.sc-num{font-family:var(--en);font-size:9px;font-weight:600;color:var(--g400);letter-spacing:1px;margin-bottom:4px;}
.sc.done .sc-num{color:var(--accent);}
.sc-title{font-size:13px;font-weight:700;}
.sc-badge{display:inline-block;margin-top:6px;padding:2px 6px;border-radius:10px;font-size:9px;font-weight:600;}
.sc-badge-done{background:var(--accent-bg);color:var(--accent);}
.sc-badge-conflict{background:var(--conflict-bg);color:var(--conflict);}
.sc-badge-lock{background:var(--g100);color:var(--g500);}

/* PRD Full Document */
.prd-doc{max-width:760px;margin:0 auto;}
.prd-section{background:var(--white);border:1px solid var(--border);margin-bottom:20px;scroll-margin-top:72px;}
.prd-sec-hd{padding:20px 28px 16px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.prd-sec-num{font-family:var(--en);font-size:10px;font-weight:600;color:var(--accent);letter-spacing:1px;margin-right:10px;}
.prd-sec-title{font-size:16px;font-weight:700;}
.prd-sec-cat{font-size:10px;color:var(--g500);letter-spacing:1px;text-transform:uppercase;}
.prd-sec-body{padding:24px 28px;}

/* Section content */
.sec-content{font-size:14px;line-height:1.8;color:var(--g700);}
.sec-content h3{font-size:13px;font-weight:700;color:var(--black);margin:20px 0 6px;letter-spacing:-.2px;}
.sec-content h3:first-child{margin-top:0;}
.sec-content p{margin-bottom:10px;}
.sec-content table{width:100%;border-collapse:collapse;margin:10px 0;}
.sec-content th,.sec-content td{padding:9px 12px;text-align:left;border-bottom:1px solid var(--border);font-size:13px;}
.sec-content th{color:var(--g500);font-weight:600;font-size:10px;letter-spacing:.5px;text-transform:uppercase;}

/* Planner Opinion */
.po{background:var(--warn-bg);border:1px solid var(--warn-border);padding:18px 20px;margin-top:20px;}
.po-title{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--warn);margin-bottom:8px;}
.po-body{font-size:13px;line-height:1.8;color:var(--g700);}
.po-body strong{color:var(--black);font-weight:600;}
.po-locked{opacity:.45;filter:blur(3px);user-select:none;pointer-events:none;}
.po-lock-msg{text-align:center;font-size:11px;color:var(--g500);margin-top:-4px;margin-bottom:8px;}

/* Conflict */
.cb{background:var(--conflict-bg);border:1px solid var(--conflict-border);padding:20px;margin-top:16px;}
.cb-title{font-size:10px;font-weight:700;color:var(--conflict);letter-spacing:1px;text-transform:uppercase;margin-bottom:12px;}
.cb-issue{font-size:14px;font-weight:700;color:var(--black);margin-bottom:10px;}
.cb-context{font-size:13px;line-height:1.7;color:var(--g600);margin-bottom:16px;}
.cb-current{background:var(--warn-bg);border:1px solid var(--warn-border);padding:14px 16px;margin-bottom:16px;}
.cb-current-title{font-size:10px;font-weight:700;color:var(--warn);letter-spacing:1px;text-transform:uppercase;margin-bottom:6px;}
.cb-current-body{font-size:13px;line-height:1.7;color:var(--g700);}
.cb-current-body strong{color:var(--black);}
.cb-input-area{display:flex;gap:8px;}
.cb-input{flex:1;padding:11px 14px;border:1px solid var(--border);background:var(--white);font-size:13px;font-family:inherit;outline:none;}
.cb-input:focus{border-color:var(--conflict);}
.cb-input::placeholder{color:var(--g400);}
.cb-submit{padding:11px 18px;background:var(--black);color:var(--white);border:none;font-size:12px;font-weight:600;font-family:inherit;cursor:pointer;}
.cb-thread{margin-top:14px;}
.cb-thread-item{padding:12px 0;border-top:1px solid var(--conflict-border);}
.cb-thread-label{font-size:10px;font-weight:600;letter-spacing:1px;text-transform:uppercase;margin-bottom:4px;}
.cb-thread-label.is-user{color:var(--g500);}
.cb-thread-label.is-ai{color:var(--accent);}
.cb-thread-body{font-size:13px;line-height:1.7;color:var(--g700);}
.cb-thread-body strong{color:var(--black);}

/* Comments */
.cmt-area{border-top:1px solid var(--border);margin-top:20px;padding-top:18px;}
.cmt-title{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--g500);margin-bottom:12px;}
.cmt{padding:10px 0;border-bottom:1px solid var(--border-light);}
.cmt:last-child{border-bottom:none;}
.cmt-hd{display:flex;align-items:center;gap:8px;margin-bottom:4px;}
.cmt-name{font-size:12px;font-weight:600;}
.cmt-role{font-size:10px;color:var(--g500);}
.cmt-time{font-size:10px;color:var(--g400);margin-left:auto;}
.cmt-body{font-size:13px;line-height:1.6;color:var(--g700);}

/* AI Revision */
.rev{background:var(--accent-bg);border:1px solid var(--accent-border);padding:18px 20px;margin-top:16px;}
.rev-title{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent);margin-bottom:8px;}
.rev-body{font-size:13px;line-height:1.8;color:var(--g700);}
.rev-body strong{color:var(--black);}
.rev-actions{display:flex;gap:8px;margin-top:12px;}
.btn-sm{padding:8px 16px;font-size:12px;font-family:inherit;font-weight:600;border:none;cursor:pointer;border-radius:4px;}
.btn-sm-y{background:var(--accent);color:var(--black);}
.btn-sm-n{background:var(--g100);color:var(--g600);}

/* Trial */
.trial{background:var(--white);border:1px solid var(--border);padding:28px;margin-top:20px;text-align:center;}
.trial-tag{font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--g500);margin-bottom:10px;}
.trial-title{font-family:var(--en);font-size:18px;font-weight:700;margin-bottom:6px;}
.trial-title em{font-style:normal;color:var(--accent);}
.trial-desc{font-size:13px;color:var(--g600);margin-bottom:18px;line-height:1.6;}
.trial-note{font-size:9px;color:var(--g400);margin-top:8px;letter-spacing:1px;}

/* Complete */
.complete-check{width:56px;height:56px;border-radius:50%;background:var(--accent-bg);border:2px solid var(--accent-border);display:flex;align-items:center;justify-content:center;margin:0 auto 20px;font-size:20px;font-weight:700;color:var(--accent);}
.complete-title{font-family:var(--en);font-size:24px;font-weight:700;text-align:center;margin-bottom:8px;}
.complete-desc{font-size:14px;color:var(--g600);text-align:center;line-height:1.6;margin-bottom:28px;}

/* Link */
.link-box{display:flex;align-items:center;gap:8px;background:var(--bg);border:1px solid var(--border);padding:12px 16px;margin-bottom:20px;}
.link-url{flex:1;font-size:13px;color:var(--g700);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-family:var(--en);}
.link-copy{padding:8px 16px;background:var(--black);color:var(--white);border:none;font-size:12px;font-family:var(--en);font-weight:600;cursor:pointer;}

/* Util */
.hidden{display:none!important;}
.fade{animation:fadeIn .35s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}
@media(max-width:768px){.title{font-size:28px;}.fg,.roles{grid-template-columns:1fr;}.sg{grid-template-columns:repeat(2,1fr);}.center{padding:32px 16px;}}
</style>
</head>
<body>

<nav class="nav">
  <div class="nav-logo">
    <svg viewBox="0 0 232.56 84.15" xmlns="http://www.w3.org/2000/svg">
      <text font-size="66.39" transform="translate(0 56.73)">
        <tspan x="0" y="0" fill="#d4f53c" font-family="Outfit" font-weight="700">ON</tspan>
        <tspan x="103.57" y="0" fill="#0a0a0a" font-family="Outfit" font-weight="500">plan</tspan>
      </text>
    </svg>
  </div>
  <div class="nav-status"><a href="index.html" style="font-size:11px;color:var(--g500);text-decoration:none;letter-spacing:1px;">← HOME</a></div>
</nav>

<!-- P1: PROJECT CREATE -->
<div id="p-create" class="page active">
  <div class="center-sm">
    <div class="tag">New Project</div>
    <h1 class="title">팀의 의견을<br><em>기획서로.</em></h1>
    <p class="desc">프로젝트를 만들고 팀에 공유하세요.<br>각자 의견을 말하면 AI 기획자가 판단하고 정리합니다.</p>
    <div class="card">
      <div class="card-title">프로젝트 생성</div>
      <div class="ff"><label class="fl">제품 이름 <span class="req">*</span></label><input id="pj-name" class="fi" placeholder="예: 발주 관리 시스템"></div>
      <div class="ff" style="margin-bottom:24px"><label class="fl">한 줄 설명</label><input id="pj-desc" class="fi" placeholder="예: 거래처 발주를 한곳에서 관리하는 시스템"></div>
      <button class="btn" onclick="createProject()">프로젝트 생성</button>
    </div>
  </div>
</div>

<!-- P2: LINK SHARE -->
<div id="p-link" class="page">
  <div class="center-sm">
    <div class="complete-check">V</div>
    <div class="complete-title">프로젝트가 생성되었습니다</div>
    <div class="complete-desc">아래 링크를 팀원들에게 공유하세요.<br>각자 자기 입장에서 AI와 인터뷰하면 됩니다.</div>
    <div class="link-box">
      <div class="link-url">onplan.onhae.com/join/a7f3k2</div>
      <button class="link-copy" onclick="this.textContent='Copied'">복사</button>
    </div>
    <p style="font-size:12px;color:var(--g500);margin-bottom:24px;line-height:1.6">카카오톡, 슬랙 등 어디든 링크를 붙여넣으면 됩니다.<br>참여자는 로그인 없이 바로 시작할 수 있습니다.</p>
    <button class="btn" onclick="go('p-landing')">참여자 화면 미리보기</button>
    <button class="btn" style="background:var(--white);color:var(--black);border:1px solid var(--border);margin-top:8px" onclick="go('p-dash')">오너 대시보드</button>
  </div>
</div>

<!-- P3: PARTICIPANT LANDING -->
<div id="p-landing" class="page">
  <div class="center-sm">
    <div class="tag" id="pj-name-display">발주 관리 시스템</div>
    <h1 class="title" style="font-size:28px">의견을<br>들려주세요.</h1>
    <p class="desc" style="font-size:14px">AI 기획자가 질문합니다. 3~5분이면 끝나요.<br>기획 지식 없이 자기 입장만 말하면 됩니다.</p>
    <div class="card">
      <div class="card-title">참여 정보</div>
      <div class="ff"><label class="fl">이름 <span class="req">*</span></label><input id="pt-name" class="fi" placeholder="홍길동"></div>
      <div class="ff" style="margin-bottom:4px"><label class="fl">역할 <span class="req">*</span></label></div>
      <div class="roles" id="role-grid">
        <div class="role-card" data-role="ceo" onclick="selectRole(this)"><div class="role-card-name">대표 / PM</div><div class="role-card-desc">사업 방향, 예산, 일정</div></div>
        <div class="role-card" data-role="dev" onclick="selectRole(this)"><div class="role-card-name">개발</div><div class="role-card-desc">기술 스택, 제약, 일정</div></div>
        <div class="role-card" data-role="design" onclick="selectRole(this)"><div class="role-card-name">디자인</div><div class="role-card-desc">UX 원칙, 참고 서비스</div></div>
        <div class="role-card" data-role="sales" onclick="selectRole(this)"><div class="role-card-name">영업 / CS</div><div class="role-card-desc">고객 불평, 경쟁사</div></div>
        <div class="role-card" data-role="user" onclick="selectRole(this)"><div class="role-card-name">실사용자</div><div class="role-card-desc">현재 업무, 불편한 점</div></div>
        <div class="role-card" data-role="other" onclick="selectRole(this)"><div class="role-card-name">기타</div><div class="role-card-desc">자유 의견</div></div>
      </div>
      <button class="btn" id="btn-join" onclick="startInterview()" style="opacity:.5;pointer-events:none">AI 인터뷰 시작하기</button>
    </div>
  </div>
</div>

<!-- P4: AI INTERVIEW -->
<div id="p-chat" class="page">
  <div style="padding:24px;">
    <div class="chat-wrap">
      <div class="chat-hd">
        <div class="chat-ai">
          <div class="chat-av">ON</div>
          <div><div class="chat-name">OnPlan AI</div><div class="chat-role-label">AI 프로덕 기획자</div></div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span style="font-size:9px;letter-spacing:1px;color:var(--g500)">CONTEXT</span>
          <div class="chat-dots" id="dots"><div class="chat-dot now"></div><div class="chat-dot"></div><div class="chat-dot"></div></div>
        </div>
      </div>
      <div class="chat-body" id="cb"></div>
      <div id="finish-bar" class="hidden" style="padding:10px 16px;border-top:1px solid var(--accent-border);background:var(--accent-bg);flex-shrink:0;">
        <button class="btn btn-accent" style="width:100%;margin:0;" onclick="go('p-complete')">인터뷰 완료 — 의견 등록하기</button>
        <p style="font-size:11px;color:var(--g500);text-align:center;margin-top:6px;">더 말할 내용이 있으면 아래에서 계속 입력 가능합니다</p>
      </div>
      <div class="chat-in" id="chat-in">
        <input class="chat-fi" id="ci" placeholder="답변을 입력하세요..." onkeydown="if(event.key==='Enter')send()">
        <button class="chat-send" onclick="send()">↑</button>
      </div>
    </div>
  </div>
</div>

<!-- P5: INTERVIEW COMPLETE -->
<div id="p-complete" class="page">
  <div class="center-sm" style="text-align:center;padding-top:120px;">
    <div class="complete-check">V</div>
    <div class="complete-title">의견이 등록되었습니다</div>
    <div class="complete-desc">다른 참여자들의 인터뷰가 완료되면<br>AI 기획자가 종합 판단하여 PRD를 생성합니다.</div>
    <div style="background:var(--white);border:1px solid var(--border);padding:20px;margin-bottom:24px;">
      <div style="font-size:11px;color:var(--g500);margin-bottom:6px;letter-spacing:1px;text-transform:uppercase">참여 현황</div>
      <div style="font-family:var(--en);font-size:28px;font-weight:800">3<span style="font-size:14px;font-weight:400;color:var(--g500)"> / 4명 완료</span></div>
    </div>
    <button class="btn" onclick="go('p-dash')">오너 대시보드 보기</button>
  </div>
</div>

<!-- P6: OWNER DASHBOARD -->
<div id="p-dash" class="page">
  <div class="center-wide">
    <div class="prd-tag">Owner Dashboard</div>
    <h2 class="prd-title" style="margin-bottom:4px" id="dash-pj-name">발주 관리 시스템</h2>
    <div class="prd-meta" style="margin-bottom:28px">생성일 2026.02.27</div>
    <div class="dash-stat">
      <div class="dash-stat-card"><div class="dash-stat-num">4</div><div class="dash-stat-label">참여자</div></div>
      <div class="dash-stat-card"><div class="dash-stat-num" style="color:var(--accent)">3</div><div class="dash-stat-label">인터뷰 완료</div></div>
      <div class="dash-stat-card"><div class="dash-stat-num" style="color:var(--g400)">1</div><div class="dash-stat-label">대기 중</div></div>
    </div>
    <div class="participant-list">
      <div class="participant-row"><div class="participant-info"><div class="participant-avatar">김</div><div><div class="participant-name">김대표</div><div class="participant-role-tag">대표 / PM</div></div></div><div class="status-done">완료</div></div>
      <div class="participant-row"><div class="participant-info"><div class="participant-avatar">이</div><div><div class="participant-name">이개발</div><div class="participant-role-tag">개발</div></div></div><div class="status-done">완료</div></div>
      <div class="participant-row"><div class="participant-info"><div class="participant-avatar">박</div><div><div class="participant-name">박영업</div><div class="participant-role-tag">영업 / CS</div></div></div><div class="status-done">완료</div></div>
      <div class="participant-row"><div class="participant-info"><div class="participant-avatar">최</div><div><div class="participant-name">최디자인</div><div class="participant-role-tag">디자인</div></div></div><div class="status-wait">대기</div></div>
    </div>
    <button class="btn btn-accent" onclick="go('p-prd')">PRD 생성하기</button>
    <p style="font-size:11px;color:var(--g500);margin-top:8px;text-align:center">3명 이상 완료 시 생성 가능</p>
  </div>
</div>

<!-- P7: PRD DASHBOARD + FULL DOCUMENT -->
<div id="p-prd" class="page">
  <div class="center-wide">
    <div class="prd-hd">
      <div>
        <div class="prd-tag">Product Requirements Document</div>
        <h2 class="prd-title" id="prd-name">발주 관리 시스템</h2>
        <div class="prd-meta">생성일 2026.02.27 · OnPlan AI v1.0 · 참여자 3명의 인터뷰 기반</div>
      </div>
      <div class="prd-actions">
        <button class="btn-ghost" onclick="alert('Team 플랜에서 사용 가능합니다.')">저장</button>
        <button class="btn-ghost" onclick="alert('Team 플랜에서 사용 가능합니다.')">공유</button>
        <button class="btn-ghost" onclick="alert('Team 플랜에서 사용 가능합니다.')">PDF</button>
      </div>
    </div>

    <!-- Section Nav Cards -->
    <div class="sg" id="sg"></div>

    <!-- Full PRD Document -->
    <div class="prd-doc" id="prd-doc"></div>

    <!-- Role Documents -->
    <div style="margin-top:40px;margin-bottom:40px;" class="prd-doc">
      <div style="margin-bottom:20px;">
        <div class="prd-tag">Role-Based Documents</div>
        <h3 style="font-family:var(--en);font-size:18px;font-weight:700;margin-bottom:4px;">역할별 문서</h3>
        <p style="font-size:13px;color:var(--g600);">PRD를 기반으로 각 역할에 맞게 변환된 문서입니다.</p>
      </div>

      <div id="role-docs" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;">
        <div class="sc done" onclick="toggleRoleDoc('rd-exec')" style="cursor:pointer;">
          <div class="sc-num">FOR CEO</div>
          <div class="sc-title">사업 타당성 요약</div>
          <div style="font-size:11px;color:var(--g500);margin-top:4px;">왜 만드는지, 비용 대비 효과, 리스크</div>
        </div>
        <div class="sc done" onclick="toggleRoleDoc('rd-dev')" style="cursor:pointer;">
          <div class="sc-num">FOR DEV</div>
          <div class="sc-title">기술 요구사항</div>
          <div style="font-size:11px;color:var(--g500);margin-top:4px;">기능 명세, IA, 기술 제약 조건</div>
        </div>
        <div class="sc done" onclick="toggleRoleDoc('rd-design')" style="cursor:pointer;">
          <div class="sc-num">FOR DESIGN</div>
          <div class="sc-title">UX 요구사항</div>
          <div style="font-size:11px;color:var(--g500);margin-top:4px;">페르소나, 사용자 여정, 핵심 플로우</div>
        </div>
        <div class="sc done" onclick="toggleRoleDoc('rd-sales')" style="cursor:pointer;">
          <div class="sc-num">FOR SALES</div>
          <div class="sc-title">제품 소개 요약</div>
          <div style="font-size:11px;color:var(--g500);margin-top:4px;">해결하는 문제, 핵심 기능, 차별점</div>
        </div>
      </div>

      <!-- Role Doc: CEO -->
      <div id="rd-exec" class="prd-section hidden">
        <div class="prd-sec-hd"><div style="display:flex;align-items:center"><span class="prd-sec-num">CEO</span><span class="prd-sec-title">사업 타당성 요약</span></div><span class="prd-sec-cat">경영 판단용</span></div>
        <div class="prd-sec-body"><div class="sec-content">
          <h3>요약</h3>
          <p>발주 누락으로 인한 월 500만원 손실을 제거하기 위한 경량 발주 관리 시스템입니다. 기존 ERP(3,000만원+) 대비 500만원 이내, 4개월 내 구축 가능합니다.</p>
          <h3>투자 대비 효과</h3>
          <table><tr><th>항목</th><th>현재</th><th>도입 후</th></tr>
          <tr><td>월 발주 누락</td><td>3~4건 (약 500만원 손실)</td><td>0건</td></tr>
          <tr><td>월말 정산 소요</td><td>3일</td><td>0.5일 (80% 절감)</td></tr>
          <tr><td>인수인계 기간</td><td>2~3주</td><td>시스템에 기록 잔존</td></tr></table>
          <h3>리스크</h3>
          <p>최대 리스크는 거래처의 시스템 사용 거부입니다. 이메일/SMS 폴백을 P0에 포함하여 대응합니다. 거래처가 시스템을 쓰지 않아도 내부 발주 관리는 정상 작동합니다.</p>
          <h3>의사결정 필요 사항</h3>
          <p>1. 거래처를 시스템 사용자로 포함할지 여부 (포함 시 +300만원, +2개월)<br>2. 일정 3개월 고수 시 대시보드 필터 간소화 수용 가능 여부</p>
        </div></div>
      </div>

      <!-- Role Doc: DEV -->
      <div id="rd-dev" class="prd-section hidden">
        <div class="prd-sec-hd"><div style="display:flex;align-items:center"><span class="prd-sec-num">DEV</span><span class="prd-sec-title">기술 요구사항</span></div><span class="prd-sec-cat">개발 착수용</span></div>
        <div class="prd-sec-body"><div class="sec-content">
          <h3>P0 기능 명세</h3>
          <table><tr><th>기능</th><th>상세</th><th>수용 기준</th></tr>
          <tr><td>발주서 생성</td><td>거래처 선택 → 품목(복수) 입력 → 단가·수량·납기일 → 미리보기 → 발송</td><td>2클릭 이내 발송 완료</td></tr>
          <tr><td>거래처 확인 알림</td><td>발송 시 이메일+SMS 동시 발송. 24h 미확인 시 자동 리마인드 1회.</td><td>알림 발송 실패 시 오너에게 알림</td></tr>
          <tr><td>현황 대시보드</td><td>상태별 목록 (대기/확인/납품/완료). 기본 목록 제공, 필터는 P1.</td><td>최근 발주 50건 1초 이내 로딩</td></tr></table>
          <h3>IA 구조</h3>
          <table><tr><th>Depth 1</th><th>Depth 2</th><th>페이지 유형</th></tr>
          <tr><td>대시보드</td><td>발주 현황</td><td>목록</td></tr>
          <tr><td>발주 관리</td><td>목록 / 상세 / 생성</td><td>목록 / 상세 / 입력</td></tr>
          <tr><td>거래처 관리</td><td>목록 / 상세</td><td>목록 / 상세</td></tr>
          <tr><td>설정</td><td>팀원/알림</td><td>상세/수정</td></tr></table>
          <h3>기술 제약</h3>
          <p>거래처 관리와 발주 관리는 DB 레벨에서 분리. 추후 거래처 포털 확장 대비.<br>알림 시스템은 외부 API 의존 (SMS: NHN Cloud 또는 유사). 실패 핸들링 필수.<br>동시 편집 충돌: 낙관적 잠금 적용.</p>
          <h3>일정 기획자 의견</h3>
          <p>P0 3개 기준 4개월 권장. 3개월 강행 시 대시보드 필터/검색 간소화 필요.</p>
        </div></div>
      </div>

      <!-- Role Doc: DESIGN -->
      <div id="rd-design" class="prd-section hidden">
        <div class="prd-sec-hd"><div style="display:flex;align-items:center"><span class="prd-sec-num">DESIGN</span><span class="prd-sec-title">UX 요구사항</span></div><span class="prd-sec-cat">디자인 착수용</span></div>
        <div class="prd-sec-body"><div class="sec-content">
          <h3>핵심 사용자</h3>
          <p><strong>1차 사용자:</strong> 구매 담당자 (일 5~10건 발주 생성, 가장 빈번한 사용자)<br><strong>2차 사용자:</strong> 운영 팀장 (현황 확인, 주 1~2회 리포트 조회)</p>
          <h3>UX 원칙</h3>
          <p>1. 교육 없이 즉시 사용 가능해야 합니다 (대표 요구사항).<br>2. 신규 발주 생성이 가장 빈번한 액션이므로 대시보드에서 2클릭 이내 도달.<br>3. 현장 직원 대상이므로 정보 밀도보다 명확한 상태 표시 우선.</p>
          <h3>핵심 플로우 (우선 설계 대상)</h3>
          <p>1. 신규 발주 생성: 대시보드 → [+새 발주] → 거래처 → 품목 → 확인 → 발송<br>2. 발주 현황 확인: 대시보드 → 상태별 목록 → 상세<br>3. 거래처 확인 응답: (거래처 측) 알림 링크 → 발주 내용 → 확인 버튼</p>
          <h3>사용자 여정</h3>
          <p>As-Is: 엑셀 → 카톡 → 구두 확인 → 수기 기록<br>To-Be: 시스템 생성 → 자동 알림 → 시스템 확인 → 자동 상태 업데이트</p>
          <h3>참고</h3>
          <p>모바일 대응 필요 (현장 사용). 좌측 사이드바(데스크톱) / 하단 탭(모바일) 네비게이션.</p>
        </div></div>
      </div>

      <!-- Role Doc: SALES -->
      <div id="rd-sales" class="prd-section hidden">
        <div class="prd-sec-hd"><div style="display:flex;align-items:center"><span class="prd-sec-num">SALES</span><span class="prd-sec-title">제품 소개 요약</span></div><span class="prd-sec-cat">고객 커뮤니케이션용</span></div>
        <div class="prd-sec-body"><div class="sec-content">
          <h3>한 줄 소개</h3>
          <p>엑셀과 카톡으로 발주를 관리하는 중소 제조업체를 위한 경량 발주 관리 시스템.</p>
          <h3>해결하는 문제</h3>
          <p>거래처 10곳 이상이면 엑셀로 감당 안 됩니다. 발주 누락, 단가 착오, 납기 지연이 반복되고 담당자 바뀌면 인수인계가 끊깁니다. 이 시스템은 발주 생성부터 거래처 확인, 현황 추적까지 한곳에서 처리합니다.</p>
          <h3>핵심 기능 3가지</h3>
          <p>1. 발주서를 1클릭으로 생성·발송하고, 거래처에 자동 알림<br>2. 거래처가 확인하지 않으면 24시간 후 자동 리마인드<br>3. 전체 발주 현황을 대시보드에서 한눈에 확인</p>
          <h3>경쟁 대비 차별점</h3>
          <p>ERP는 너무 비싸고(3,000만원+) 복잡합니다. 이 시스템은 발주 프로세스에만 집중하여 500만원 이내, 교육 없이 바로 사용 가능합니다.</p>
          <h3>고객 대상</h3>
          <p>거래처 10~50곳 규모의 중소 제조업체. 구매팀 1~5명. 현재 엑셀+메신저로 발주 관리 중인 곳.</p>
        </div></div>
      </div>
    </div>

    <!-- Trial -->
    <div class="trial">
      <div class="trial-tag">TRIAL</div>
      <div class="trial-title">수정하고, 공유하고, <em>함께 완성</em>하세요</div>
      <div class="trial-desc">기획자 의견 전체 열람, 섹션별 수정, 팀 코멘트까지.<br>체험판에서는 기획자 의견을 2개 섹션만 볼 수 있습니다.</div>
      <button class="btn" style="width:auto;display:inline-block;padding:13px 32px;">Team 플랜 시작하기 — ₩49,000/월</button>
      <div class="trial-note">5시트 포함 · 언제든 해지 가능</div>
    </div>
  </div>
</div>

<script>
// ===== DATA =====
const SEC=[
  {n:'01',t:'요약과 배경',d:'문제 정의, 시장 맥락',c:'맥락',conflict:false},
  {n:'02',t:'주요 사용자',d:'페르소나, 페인포인트',c:'맥락',conflict:true},
  {n:'03',t:'핵심 사용자 여정',d:'As-Is / To-Be',c:'정의',conflict:false},
  {n:'04',t:'기능적 요구사항',d:'P0 / P1 / P2',c:'정의',conflict:true},
  {n:'05',t:'IA 설계',d:'페이지 맵, 네비게이션',c:'설계',conflict:false},
  {n:'06',t:'사용자 플로우',d:'핵심 시나리오',c:'설계',conflict:false},
  {n:'07',t:'배포 계획',d:'마일스톤, 일정',c:'실행',conflict:true},
  {n:'08',t:'리스크 및 관련 문서',d:'제약, 의존성',c:'검증',conflict:false},
];

const CONFLICTS={
'02':{
  issue:'거래처를 시스템 사용자로 포함할 것인가',
  context:'일부 참여자는 내부 사용자만 고려하면 된다는 입장이고, 다른 참여자는 거래처도 시스템에서 직접 확인할 수 있어야 한다고 봅니다.',
  current:'MVP에서는 <strong>내부 사용자로 한정</strong>을 권장합니다. 거래처 포함 시 거래처 포털이 P0으로 올라가며 예산 +300만원, 일정 +2개월이 필요합니다. 거래처에는 이메일/SMS 알림으로 우선 대응 가능합니다.',
  demoReply:'거래처 포털 없이 이메일 알림만으로도 거래처 확인율은 확보됩니다. 다만, <strong>거래처가 알림 내에서 1클릭으로 확인할 수 있는 웹 링크</strong>를 제공하면 별도 포털 없이도 확인 프로세스가 가능합니다. 이 경우 추가 비용은 약 50만원, 일정 영향 없습니다. 이 방향으로 PRD 02, 04 섹션을 수정할까요?'
},
'04':{
  issue:'P0 기능 범위를 어디까지 잡을 것인가',
  context:'경영 관점에서는 자동 리포트, 거래처 포털 포함 5개 기능을 P0으로 원하고 있으나, 기술 관점에서는 3개도 일정이 빠듯하다는 의견입니다.',
  current:'500만원·3개월 기준 <strong>P0은 3개가 한계</strong>입니다. P0 5개를 원하시면 예산 800만원 또는 일정 5개월이 필요합니다. 자동 리포트와 거래처 포털은 P2로 분류했습니다.',
  demoReply:'자동 리포트를 P1으로 올리되 납품 검수를 P2로 내리면 <strong>4개월 내 가능</strong>합니다. 리포트는 월 1회 사용이지만 경영진 보고에 직결되므로 P1이 적절합니다. 이 조정을 반영하면 04, 07 섹션이 함께 변경됩니다.'
},
'07':{
  issue:'개발 일정을 몇 개월로 잡을 것인가',
  context:'경영 관점에서는 3개월 내 출시를 요구하고 있으나, 기술 관점에서는 6개월이 현실적이라는 의견입니다.',
  current:'P0 3개 기준 <strong>4개월을 권장</strong>합니다. 3개월에 맞추려면 대시보드 필터/검색을 간소화해야 합니다 (기본 목록만 제공). 초기 거래처 3곳 기준으로 수용 가능합니다.',
  demoReply:'3개월 출시가 투자 미팅과 연결되어 있다면, <strong>3개월에 코어 기능만 출시 + 1개월 후 업데이트</strong> 전략이 가능합니다. 1차 출시에서 필터를 빼고 기본 목록만 제공, 4개월차에 필터/검색 추가. 투자 미팅에는 실동작 데모를 보여줄 수 있습니다. 이 방향으로 07 섹션을 수정할까요?'
}
};

const BODY={
'01':'<h3>문제 정의</h3><p>중소 제조업체의 발주 관리는 여전히 엑셀과 메신저에 의존하고 있습니다. 거래처가 10곳을 넘어가면 발주 누락, 단가 착오, 납기 지연이 반복 발생하며, 담당자 교체 시 인수인계 단절이 심각한 운영 리스크입니다.</p><h3>왜 지금인가</h3><p>거래처 확장으로 월 3~4건의 발주 누락 발생 중. 월간 손실 약 500만원 추산. 기존 ERP 도입은 비용(3,000만원+)과 학습 곡선으로 비현실적이며, 핵심 발주 프로세스에 특화된 경량 솔루션이 필요합니다.</p><h3>시장 맥락</h3><p>국내 중소 제조업체 약 12만 곳 중 전용 발주 시스템 사용률 15% 미만. 엑셀(68%), 수기(12%), 메신저(5%) 등으로 처리 중이며 명확한 시장 기회가 존재합니다.</p>',
'02':'<h3>Persona A — 김재현 (구매 담당자)</h3><table><tr><th>항목</th><th>내용</th></tr><tr><td>역할</td><td>중소 제조업체 구매팀 3년차</td></tr><tr><td>페인포인트</td><td>거래처 30곳 엑셀 관리. 단가 이력 추적 불가. 카톡 누락으로 납기 지연.</td></tr><tr><td>원하는 것</td><td>발주 현황 한눈에, 거래처 확인까지 시스템 내 완결</td></tr></table><h3>Persona B — 박소영 (운영 팀장)</h3><table><tr><th>항목</th><th>내용</th></tr><tr><td>역할</td><td>5명 구매팀 관리, 경영진 보고</td></tr><tr><td>페인포인트</td><td>팀원별 현황 취합 수동. 월말 단가 불일치.</td></tr><tr><td>원하는 것</td><td>팀 전체 대시보드, 자동 리포트</td></tr></table>',
'03':'<h3>As-Is</h3><p>엑셀 발주서 → 카톡 전달 → 구두 확인 → 별도 엑셀 기록 → 수기 대조 → 수동 정산</p><h3>To-Be</h3><p>시스템 발주 생성 → 자동 알림 → 시스템 내 확인 → 상태 자동 업데이트 → 자동 대조 → 자동 정산</p><h3>사용자가 얻는 가치</h3><p>발주 누락 제로, 단가 이력 자동 추적, 인수인계 연속성 확보, 월말 정산 80% 절감.</p>',
'04':'<h3>P0 — Must Have</h3><table><tr><th>기능</th><th>수용 기준</th></tr><tr><td>발주서 생성/발송</td><td>품목·수량·단가·납기일 입력, 1클릭 발송</td></tr><tr><td>거래처 확인 알림</td><td>24시간 미확인 시 자동 리마인드</td></tr><tr><td>현황 대시보드</td><td>상태별 필터, 검색</td></tr></table><h3>P1 — Should Have</h3><table><tr><th>기능</th><th>수용 기준</th></tr><tr><td>단가 이력 관리</td><td>거래처×품목별 변경 히스토리</td></tr><tr><td>납품 검수</td><td>수량/품질 체크, 사진 첨부</td></tr></table><h3>P2 — Nice to Have</h3><table><tr><th>기능</th><th>수용 기준</th></tr><tr><td>월간 자동 리포트</td><td>발주 금액, 납기 준수율 자동 생성</td></tr><tr><td>거래처 포털</td><td>거래처 직접 로그인, 발주 확인</td></tr></table>',
'05':'<h3>페이지 맵</h3><table><tr><th>Depth 1</th><th>Depth 2</th><th>유형</th></tr><tr><td>대시보드</td><td>발주 현황 요약</td><td>목록+결과</td></tr><tr><td>발주 관리</td><td>목록 / 상세 / 생성</td><td>목록 / 상세 / 입력</td></tr><tr><td>거래처 관리</td><td>목록 / 상세</td><td>목록 / 상세</td></tr><tr><td>리포트</td><td>월간 분석</td><td>실행+결과</td></tr><tr><td>설정</td><td>팀원/권한/알림</td><td>상세/수정</td></tr></table><h3>네비게이션</h3><p>좌측 사이드바 고정. 대시보드 / 발주관리 / 거래처관리 / 리포트 / 설정. 모바일 하단 탭.</p>',
'06':'<h3>시나리오 1: 신규 발주</h3><p>대시보드 → [+새 발주] → 거래처 선택 → 품목 입력 → 미리보기 → 발송 → 대시보드 "대기"</p><h3>시나리오 2: 거래처 확인 및 납품</h3><p>알림 수신 → 접속 → 확인 → "확인됨" → 납품 시 검수 → "완료"</p><h3>시나리오 3: 월말 정산</h3><p>리포트 → 기간/거래처 필터 → 생성 → 금액·준수율 → PDF 다운로드</p>',
'07':'<h3>Phase 1 — MVP (1~2개월)</h3><p>발주 생성/발송, 거래처 확인, 대시보드. 파일럿 3곳.</p><h3>Phase 2 — 안정화 (3~4개월)</h3><p>단가 이력, 검수, 알림 고도화. 거래처 10곳.</p><h3>Phase 3 — 확장 (5~6개월)</h3><p>리포트, 거래처 포털, 모바일. 정식 출시.</p>',
'08':'<h3>리스크</h3><table><tr><th>리스크</th><th>영향도</th><th>대응</th></tr><tr><td>거래처 시스템 사용 거부</td><td>높음</td><td>이메일/SMS 폴백</td></tr><tr><td>엑셀 데이터 마이그레이션</td><td>중간</td><td>임포트 기능 우선</td></tr><tr><td>동시 접속 충돌</td><td>낮음</td><td>낙관적 잠금</td></tr></table><h3>관련 문서</h3><p>추후 연결: UX 플로우, API 명세서, DB 스키마, QA 체크리스트</p>'
};

const OPINION={
'01':'<strong>대표와 영업의 문제 인식이 다릅니다.</strong> 대표는 운영 효율(발주 누락 방지), 영업은 고객 관계(납기 지연으로 인한 신뢰 하락)를 강조했습니다. 둘 다 유효하나 MVP에서는 <strong>발주 누락 방지가 우선</strong>입니다. 납기 지연은 발주가 제대로 관리되면 자연히 줄어드는 후행 지표입니다.',
'02':'<strong>거래처를 사용자로 포함할지 결정이 없었습니다.</strong> 영업팀은 "거래처도 시스템에서 확인하면 좋겠다"고 했으나, 대표와 개발팀은 내부 사용자만 언급했습니다. <strong>거래처를 사용자로 포함하면 거래처 포털이 P0으로 올라가며 예산 300만원, 일정 2개월 추가</strong>가 필요합니다. 결정이 필요합니다.',
'03':'현재 플로우에서 <strong>가장 손실이 큰 구간은 "발주 확인"</strong>입니다. 엑셀 발주서를 카톡으로 보내고 구두로 확인받는 과정에서 누락이 발생합니다. 이 구간을 먼저 자동화하는 것을 권장합니다.',
'04':'<strong>대표 요청 5개 중 P0은 3개로 제한했습니다.</strong> 500만원·3개월 기준으로 P0 5개는 불가능합니다. P0 5개를 원하시면 예산 800만원 또는 일정 5개월이 필요합니다. 자동 리포트와 거래처 포털은 P2로 내렸습니다. 둘 다 "있으면 좋겠다"이지 "없으면 안 된다"가 아닙니다.',
'05':'발주 관리와 거래처 관리를 <strong>분리</strong>했습니다. 개발팀에서 합치자는 의견이 있었으나, 데이터 구조상 분리가 확장성에 유리합니다. 추후 거래처 포털을 붙일 때 분리된 구조가 필수입니다.',
'06':'시나리오 3개 중 <strong>"신규 발주"가 가장 빈번</strong>합니다 (일 5~10건 추정). 이 플로우의 클릭 수를 최소화하는 것이 핵심입니다. 대시보드에서 2클릭 이내에 발주 발송이 가능해야 합니다.',
'07':'<strong>개발팀 6개월 vs 대표 3개월.</strong> P0 3개 기준 <strong>4개월을 권장</strong>합니다. 3개월에 맞추려면 납품 검수(P1)를 P2로 내려야 합니다. MVP에서 납품 확인이 수동이 되지만 초기에는 수용 가능합니다.',
'08':'<strong>거래처 시스템 사용 거부가 최대 리스크입니다.</strong> 아무도 이 문제를 언급하지 않았으나, 이 업종에서 가장 흔한 실패 원인입니다. 이메일/SMS 폴백을 P0에 포함시켰습니다.'
};

const COMMENTS={
'04':[
  {name:'김대표',role:'대표',time:'10분 전',body:'자동 리포트는 꼭 넣어주세요. 매달 수작업으로 보고서 만드는 게 너무 힘듭니다.'},
  {name:'이개발',role:'개발',time:'5분 전',body:'P0 3개도 3개월은 빡빡합니다. 알림 시스템이 생각보다 복잡해요.'},
],
'07':[
  {name:'김대표',role:'대표',time:'8분 전',body:'4개월이요? 3개월 안에 무조건 나와야 합니다. 투자 미팅이 있어요.'},
]
};

const REVISION={
'04':'자동 리포트를 P1으로 올리면 <strong>일정이 1개월 늘어납니다</strong> (4개월 → 5개월). 대신 납품 검수를 P2로 내리면 <strong>4개월 내 가능</strong>합니다.<br><br>정리하면:<br>— 안 A: P0 3개 + 자동 리포트(P1) = 5개월<br>— 안 B: P0 3개 + 자동 리포트(P1) - 납품 검수(→P2) = 4개월<br>— 안 C: 현행 유지 (자동 리포트 P2) = 4개월<br><br><strong>어떻게 하시겠습니까?</strong>',
'07':'3개월에 맞추려면 <strong>2가지 중 하나를 선택</strong>해야 합니다.<br><br>— 안 A: 거래처 확인 알림을 P1으로 내림 → 수동 확인 (카톡 유지)<br>— 안 B: 대시보드 필터/검색을 간소화 → 기본 목록만 제공<br><br>안 A는 핵심 가치(발주 누락 방지)를 훼손하므로 <strong>안 B를 권장</strong>합니다. 필터 없이 목록만 있어도 초기 거래처 3곳에서는 충분합니다.'
};

const RQ={
  ceo:['안녕하세요. 대표님 관점에서 여쭤보겠습니다. 이 제품을 왜 지금 만들려고 하시나요? 가장 큰 계기가 무엇인가요?','예산과 일정은 어떻게 생각하고 계신가요? 이것이 성공하면 어떤 상태인가요?','절대 안 되는 것이 있나요? "이것만은 피해야 한다" 같은 제약 조건이 있다면 말씀해주세요.','이 제품의 첫 번째 고객은 누구라고 생각하시나요? 내부 사용자인가요, 외부 고객인가요?','경쟁 서비스나 대안으로 검토해본 것이 있나요?','추가로 전달하고 싶은 내용이 있으시면 말씀해주세요.'],
  dev:['안녕하세요. 개발자 관점에서 여쭤보겠습니다. 현재 사용 중인 기술 스택이 있나요? 기술적 제약 사항은요?','이 시스템을 만든다면 현실적으로 몇 개월이 필요하다고 보시나요? 가장 까다로운 부분은 무엇인가요?','기존에 쌓여있는 기술 부채나, 연동해야 하는 외부 시스템이 있나요?','성능이나 보안 측면에서 특별히 신경 써야 할 부분이 있나요?','인프라 환경은 어떻게 생각하시나요? 클라우드, 온프레미스 등.','추가로 전달하고 싶은 내용이 있으시면 말씀해주세요.'],
  sales:['안녕하세요. 영업/CS 관점에서 여쭤보겠습니다. 고객이 가장 많이 불평하는 것이 무엇인가요?','경쟁사 대비 우리가 부족한 점은 무엇인가요? 고객이 이탈하는 가장 큰 사유는요?','고객이 "이것만 있으면 바로 쓰겠다"고 한 기능이 있나요?','고객 응대 과정에서 반복적으로 시간을 잡아먹는 업무가 있나요?','고객이 가장 만족하는 부분은 무엇인가요? 그걸 더 강화할 수 있을까요?','추가로 전달하고 싶은 내용이 있으시면 말씀해주세요.'],
  user:['안녕하세요. 실제로 이 업무를 하고 계신 분이시군요. 지금 이 업무를 어떻게 처리하고 계신가요?','가장 불편한 점이 무엇인가요? 가장 시간이 오래 걸리는 작업은요?','절대 있어야 하는 기능과, 절대 없어야 하는 것이 있나요?','같은 업무를 하는 다른 분들도 같은 불편을 느끼고 있나요?','하루 중 이 업무에 시간을 얼마나 쓰시나요?','추가로 전달하고 싶은 내용이 있으시면 말씀해주세요.'],
  design:['안녕하세요. 디자인 관점에서 여쭤보겠습니다. 참고하면 좋을 서비스나 디자인이 있나요?','UX에서 가장 중요하게 생각하는 원칙이 있나요?','기존 디자인 자산(디자인 시스템, 컴포넌트)이 있나요?','사용자가 가장 자주 접하게 될 화면은 무엇이라고 생각하시나요?','모바일 대응이 필요한가요? 주 사용 환경은 어디인가요?','추가로 전달하고 싶은 내용이 있으시면 말씀해주세요.'],
  other:['안녕하세요. 이 프로젝트에 대해 자유롭게 의견을 들려주세요. 가장 중요하다고 생각하는 것이 무엇인가요?','걱정되는 부분이 있나요?','추가로 꼭 전달하고 싶은 의견이 있나요?','이 프로젝트가 성공하려면 반드시 피해야 할 것이 있나요?','다른 분들의 의견 중 동의하지 않는 부분이 있을 수 있나요?','자유롭게 더 말씀해주세요.']
};

let selectedRole='',qIdx=0,projectName='';

// ===== NAV =====
function go(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');window.scrollTo(0,0);}

function createProject(){
  const n=document.getElementById('pj-name').value.trim();if(!n)return;
  projectName=n;
  document.getElementById('pj-name-display').textContent=n;
  document.getElementById('dash-pj-name').textContent=n;
  document.getElementById('prd-name').textContent=n;
  go('p-link');
}

function selectRole(el){
  document.querySelectorAll('.role-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');selectedRole=el.dataset.role;
  const b=document.getElementById('btn-join');b.style.opacity='1';b.style.pointerEvents='auto';
}

function startInterview(){
  if(!selectedRole||!document.getElementById('pt-name').value.trim())return;
  go('p-chat');qIdx=0;document.getElementById('cb').innerHTML='';
  setTimeout(()=>{addMsg('assistant',RQ[selectedRole][0]);updateDots(0);},500);
}

// ===== CHAT =====
function addMsg(r,t){const b=document.getElementById('cb'),d=document.createElement('div');d.className=`msg ${r} fade`;d.innerHTML=r==='assistant'?`<div class="msg-av">ON</div><div class="msg-b">${t}</div>`:`<div class="msg-b">${t}</div>`;b.appendChild(d);b.scrollTop=b.scrollHeight;}
function addTyping(){const b=document.getElementById('cb'),d=document.createElement('div');d.className='msg assistant';d.id='typing';d.innerHTML=`<div class="msg-av">ON</div><div class="msg-typing"><span></span><span></span><span></span></div>`;b.appendChild(d);b.scrollTop=b.scrollHeight;}
function updateDots(i){document.querySelectorAll('#dots .chat-dot').forEach((d,x)=>{d.classList.remove('on','now');if(x<i)d.classList.add('on');if(x===i)d.classList.add('now');});}

function send(){
  const inp=document.getElementById('ci'),t=inp.value.trim();if(!t)return;
  addMsg('user',t);inp.value='';qIdx++;updateDots(Math.min(qIdx,3));
  // Show finish button after 3 answers
  if(qIdx>=3){document.getElementById('finish-bar').classList.remove('hidden');}
  const qs=RQ[selectedRole];
  if(qIdx<qs.length){
    addTyping();setTimeout(()=>{document.getElementById('typing')?.remove();addMsg('assistant',qs[qIdx]);},1000);
  } else {
    // Past scripted questions — acknowledge freely
    addTyping();setTimeout(()=>{document.getElementById('typing')?.remove();addMsg('assistant','확인했습니다. 추가 의견이 더 있으시면 계속 말씀해주세요.');},800);
  }
}

// ===== PRD RENDER =====
function renderPRD(){
  // Nav cards
  const sg=document.getElementById('sg');sg.innerHTML='';
  SEC.forEach((s,i)=>{
    const locked=i>=6;
    const d=document.createElement('div');
    d.className=`sc ${locked?'lock':'done'} fade`;d.style.animationDelay=`${i*.05}s`;
    let badge;
    if(locked) badge='<div class="sc-badge sc-badge-lock">TEAM</div>';
    else if(s.conflict) badge='<div class="sc-badge sc-badge-conflict">ISSUE</div>';
    else badge='<div class="sc-badge sc-badge-done">DONE</div>';
    d.innerHTML=`<div class="sc-num">${s.n}</div><div class="sc-title">${s.t}</div>${badge}`;
    d.onclick=()=>{
      if(locked){alert('Team 플랜에서 열람할 수 있습니다.');return;}
      const el=document.getElementById('sec-'+s.n);if(el)el.scrollIntoView({behavior:'smooth'});
    };
    sg.appendChild(d);
  });

  // Full document
  const doc=document.getElementById('prd-doc');doc.innerHTML='';
  SEC.forEach((s,i)=>{
    const locked=i>=6;
    const section=document.createElement('div');
    section.className='prd-section fade';section.id='sec-'+s.n;
    section.style.animationDelay=`${i*.06+.3}s`;

    let html=`<div class="prd-sec-hd"><div style="display:flex;align-items:center"><span class="prd-sec-num">${s.n}</span><span class="prd-sec-title">${s.t}</span></div><span class="prd-sec-cat">${s.c}</span></div>`;

    if(locked){
      html+=`<div class="prd-sec-body" style="opacity:.3;filter:blur(4px);user-select:none;min-height:120px;"><div class="sec-content">${BODY[s.n]||''}</div></div>`;
    } else {
      html+=`<div class="prd-sec-body">`;

      // Planner opinion
      if(OPINION[s.n]){
        const opLocked=i>=2;
        if(opLocked){
          html+=`<div class="po po-locked"><div class="po-title">PLANNER OPINION</div><div class="po-body">${OPINION[s.n]}</div></div><div class="po-lock-msg">기획자 의견은 Team 플랜에서 열람 가능합니다</div>`;
        } else {
          html+=`<div class="po"><div class="po-title">PLANNER OPINION</div><div class="po-body">${OPINION[s.n]}</div></div>`;
        }
      }

      // Conflict Resolution
      if(s.conflict && CONFLICTS[s.n]){
        const cf=CONFLICTS[s.n];
        const cfId='cf-'+s.n;
        html+=`<div class="cb">
          <div class="cb-title">OPEN ISSUE</div>
          <div class="cb-issue">${cf.issue}</div>
          <div class="cb-context">${cf.context}</div>
          <div class="cb-current">
            <div class="cb-current-title">AI PLANNER RECOMMENDATION</div>
            <div class="cb-current-body">${cf.current}</div>
          </div>
          <div class="cb-input-area" id="${cfId}-input-area">
            <input class="cb-input" id="${cfId}-input" placeholder="이 논점에 대한 의견을 입력하세요..." onkeydown="if(event.key==='Enter')submitIssueComment('${cfId}')">
            <button class="cb-submit" onclick="submitIssueComment('${cfId}')">전송</button>
          </div>
          <div class="cb-thread" id="${cfId}-thread"></div>
        </div>`;
      }

      // Content
      html+=`<div class="sec-content">${BODY[s.n]||''}</div>`;

      // Comments
      if(COMMENTS[s.n]){
        html+=`<div class="cmt-area"><div class="cmt-title">TEAM COMMENTS</div>`;
        COMMENTS[s.n].forEach(c=>{
          html+=`<div class="cmt"><div class="cmt-hd"><span class="cmt-name">${c.name}</span><span class="cmt-role">${c.role}</span><span class="cmt-time">${c.time}</span></div><div class="cmt-body">${c.body}</div></div>`;
        });
        html+=`</div>`;
      }

      // AI Revision
      if(REVISION[s.n]){
        html+=`<div class="rev"><div class="rev-title">AI PLANNER REVISION</div><div class="rev-body">${REVISION[s.n]}</div><div class="rev-actions"><button class="btn-sm btn-sm-y" onclick="alert('반영되었습니다.')">승인</button><button class="btn-sm btn-sm-n" onclick="alert('거부되었습니다.')">거부</button></div></div>`;
      }

      html+=`</div>`;
    }

    section.innerHTML=html;
    doc.appendChild(section);
  });
}

// Issue discussion
function submitIssueComment(cfId){
  const inp=document.getElementById(cfId+'-input');
  const t=inp.value.trim();if(!t)return;
  const thread=document.getElementById(cfId+'-thread');
  // User comment
  const userItem=document.createElement('div');
  userItem.className='cb-thread-item fade';
  userItem.innerHTML=`<div class="cb-thread-label is-user">YOUR OPINION</div><div class="cb-thread-body">${t}</div>`;
  thread.appendChild(userItem);
  inp.value='';
  // AI reply (demo)
  const secNum=cfId.replace('cf-','');
  const reply=CONFLICTS[secNum]?.demoReply||'의견을 확인했습니다. 관련 섹션에 미치는 영향을 분석 중입니다.';
  setTimeout(()=>{
    const aiItem=document.createElement('div');
    aiItem.className='cb-thread-item fade';
    aiItem.innerHTML=`<div class="cb-thread-label is-ai">AI PLANNER FEEDBACK</div><div class="cb-thread-body">${reply}</div>`;
    thread.appendChild(aiItem);
    aiItem.scrollIntoView({behavior:'smooth',block:'nearest'});
  },800);
}

// Role doc toggle
function toggleRoleDoc(id){
  const el=document.getElementById(id);
  if(el.classList.contains('hidden')){el.classList.remove('hidden');el.scrollIntoView({behavior:'smooth',block:'start'});}
  else{el.classList.add('hidden');}
}

// Watch for PRD page activation
const obs=new MutationObserver(()=>{if(document.getElementById('p-prd').classList.contains('active'))renderPRD();});
obs.observe(document.getElementById('p-prd'),{attributes:true,attributeFilter:['class']});
</script>
</body>
</html>
